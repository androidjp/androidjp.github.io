<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-smile.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-smile.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="引言：  Greenwich.SR3 Release Blog Greenwich.SR4 Release Blog  总体框架 gradle版本：6.0.1 Spring Boot版本：2.1.10.RELEASE Spring Cloud版本：Greenwich.SR4 服务注册与发现：Eureka 配置中心：Spring Cloud Config">
<meta name="keywords" content="gradle,spring cloud">
<meta property="og:type" content="article">
<meta property="og:title" content="用Gradle从零搭建 Spring Cloud Greenwich.SR4  微服务项目（一）-- 基础入门">
<meta property="og:url" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;%E7%94%A8Gradle%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%20Spring%20Cloud%20Greenwich.SR4%20%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%88%E4%B8%80%EF%BC%89--%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8&#x2F;index.html">
<meta property="og:site_name" content="jpuneng技术栈">
<meta property="og:description" content="引言：  Greenwich.SR3 Release Blog Greenwich.SR4 Release Blog  总体框架 gradle版本：6.0.1 Spring Boot版本：2.1.10.RELEASE Spring Cloud版本：Greenwich.SR4 服务注册与发现：Eureka 配置中心：Spring Cloud Config">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;1.png">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;2.png">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;3.png">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;4.png">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;5.png">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;6.png">
<meta property="og:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;7.png">
<meta property="og:updated_time" content="2020-09-27T03:15:04.268Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;jpuneng.cn&#x2F;images&#x2F;spring_cloud&#x2F;1.png">

<link rel="canonical" href="http://jpuneng.cn/%E7%94%A8Gradle%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%20Spring%20Cloud%20Greenwich.SR4%20%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%88%E4%B8%80%EF%BC%89--%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>用Gradle从零搭建 Spring Cloud Greenwich.SR4  微服务项目（一）-- 基础入门 | jpuneng技术栈</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jpuneng技术栈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">技术时代，舍我其谁</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://jpuneng.cn/%E7%94%A8Gradle%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%20Spring%20Cloud%20Greenwich.SR4%20%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%88%E4%B8%80%EF%BC%89--%20%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Jasper Wu">
      <meta itemprop="description" content="醒目点、自觉点、速度点，努力奋斗下去，走好自己的路！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jpuneng技术栈">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          用Gradle从零搭建 Spring Cloud Greenwich.SR4  微服务项目（一）-- 基础入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-04 20:26:56" itemprop="dateCreated datePublished" datetime="2019-12-04T20:26:56+08:00">2019-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-27 11:15:04" itemprop="dateModified" datetime="2020-09-27T11:15:04+08:00">2020-09-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-cloud/" itemprop="url" rel="index">
                    <span itemprop="name">spring cloud</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-cloud/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>引言：</p>
<ul>
<li><a href="https://spring.io/blog/2019/09/12/spring-cloud-greenwich-sr3-released" target="_blank" rel="noopener">Greenwich.SR3 Release Blog</a></li>
<li><a href="https://spring.io/blog/2019/11/19/spring-cloud-greenwich-sr4-released" target="_blank" rel="noopener">Greenwich.SR4 Release Blog</a></li>
</ul>
</blockquote><h1 id="总体框架"><a href="#总体框架" class="headerlink" title="总体框架"></a>总体框架</h1><ul>
<li>gradle版本：6.0.1</li>
<li>Spring Boot版本：2.1.10.RELEASE</li>
<li>Spring Cloud版本：Greenwich.SR4</li>
<li>服务注册与发现：Eureka</li>
<li>配置中心：Spring Cloud Config</li>
</ul><a id="more"></a>

<h1 id="相关规范"><a href="#相关规范" class="headerlink" title="相关规范"></a>相关规范</h1><p>端口：</p>
<ul>
<li>基础服务（<code>basic-xxx</code>）：90xx ~ 91xx<ul>
<li>注册服务器（<code>basic-registry</code>）：900x</li>
<li>配置服务器（<code>basic-config</code>）：901x</li>
<li>路由服务器（<code>basic-gateway</code>）：902x</li>
<li>其他基础服务器</li>
</ul>
</li>
<li>业务相关微服务: 92xx ~</li>
</ul>
<h1 id="一、搭建一个父Gradle目录-root-project"><a href="#一、搭建一个父Gradle目录-root-project" class="headerlink" title="一、搭建一个父Gradle目录(root project)"></a>一、搭建一个父Gradle目录(root project)</h1><h2 id="纯命令create"><a href="#纯命令create" class="headerlink" title="纯命令create"></a>纯命令create</h2><ol>
<li>新创建项目纯gradle项目 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir jp-cloud-gradle</span><br><span class="line">cd jp-cloud-gradle</span><br><span class="line">gradle init --type=basic</span><br></pre></td></tr></table></figure></li>
<li>假设你现在的系统全局Gradle版本是5.4.1，那么，如果要变成Gradle 6.0.1，两个选择：<ol>
<li>将当前系统Gradle换成6.0.1，然后执行运行<code>gradle wrapper</code>，即可将当前项目换成当前系统默认Gradle版本。然后执行<code>gradlew</code>即可用到当前6.0.1版本去进行项目构建；</li>
<li>直接用当前生成的5.4.1版本的Gradle命令，来切换版本至6.0.1：  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gradlew wrapper --gradle-version=6.0.1</span><br><span class="line">gradlew</span><br><span class="line">// or gradlew tasks</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li>更新root project的<code>build.gradle</code>，将Spring Cloud 和 Spring Boot相关基础依赖集成进来： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;java&apos;</span><br><span class="line">group &apos;com.jpcloud&apos;</span><br><span class="line">version &apos;1.0.0&apos;</span><br><span class="line"></span><br><span class="line">sourceCompatibility = 1.8</span><br><span class="line"></span><br><span class="line">buildscript &#123;</span><br><span class="line">    ext &#123;</span><br><span class="line">        //定义一个变量，统一规定springboot的版本</span><br><span class="line">        // 注意：Spring Boot版本一定要匹配上 Spring Cloud 版本</span><br><span class="line">        // There should be a mismatch version between spring boot and spring cloud.</span><br><span class="line">        // If you use spring boot version 2.2.0.RELEASE you have to use spring cloud version Hoxton.RC1.</span><br><span class="line">        // If you use spring boot version 2.1.9.RELEASE, you have to use spring cloud version Greenwich.SR3.</span><br><span class="line">        // If you use spring boot version 2.1.10.RELEASE, you have to use spring cloud version Greenwich.SR4.</span><br><span class="line">        // 否则，会报错：No qualifying bean of type &apos;javax.servlet.Filter&apos; available</span><br><span class="line">        springBootVersion = &apos;2.1.10.RELEASE&apos;</span><br><span class="line">        springCloudVersion = &apos;Greenwich.SR4&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &apos;http://maven.aliyun.com/nexus/content/groups/public/&apos; &#125;</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;//用来打包</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:$&#123;springBootVersion&#125;&quot;)</span><br><span class="line">        // 作用：设置依赖管理插件版本</span><br><span class="line">        classpath &quot;io.spring.gradle:dependency-management-plugin:1.0.2.RELEASE&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url &apos;http://maven.aliyun.com/nexus/content/groups/public/&apos; &#125;</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    // 指定编码格式</span><br><span class="line">    tasks.withType(JavaCompile) &#123;</span><br><span class="line">        options.encoding = &quot;UTF-8&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 作用：配置这个项目的子项目。这个方法对这个项目的每个子项目执行给定的闭包。目标项目作为闭包的委托传递给闭包</span><br><span class="line">subprojects &#123;</span><br><span class="line">    apply plugin: &apos;java&apos;</span><br><span class="line">    apply plugin: &apos;idea&apos;</span><br><span class="line">    // spring boot 插件</span><br><span class="line">    apply plugin: &apos;org.springframework.boot&apos;</span><br><span class="line">    // A Gradle plugin that provides Maven-like dependency management functionality</span><br><span class="line">    apply plugin: &apos;io.spring.dependency-management&apos;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        testCompile group: &apos;org.springframework.boot&apos;, name: &apos;spring-boot-starter-test&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    dependencyManagement &#123;</span><br><span class="line">        imports &#123;</span><br><span class="line">            //spring bom helps us to declare dependencies without specifying version numbers.</span><br><span class="line">            mavenBom &quot;org.springframework.cloud:spring-cloud-dependencies:$&#123;springCloudVersion&#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    jar &#123;</span><br><span class="line">        manifest.attributes provider: &apos;gradle&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>最终，使用的相关版本是：</p>
<ul>
<li>Spring Cloud: GreenWich SR4 (基于Spring Boot 2.1.10)</li>
<li>Spring Boot: 2.1.10</li>
</ul>
<h1 id="二、服务注册与发现"><a href="#二、服务注册与发现" class="headerlink" title="二、服务注册与发现"></a>二、服务注册与发现</h1><h2 id="相关依赖"><a href="#相关依赖" class="headerlink" title="相关依赖"></a>相关依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.cloud:spring-cloud-starter-netflix-eureka-server</span><br></pre></td></tr></table></figure>

<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>创建一个module <code>basic-registry</code>，纯命令操作如下： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir basic-registry</span><br><span class="line">cd basic-registry</span><br><span class="line">gradlew init</span><br></pre></td></tr></table></figure></li>
<li>配置<code>build.gradle</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-netflix-eureka-server&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置<code>application.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9000</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: basic-registry</span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    hostname: localhost</span><br><span class="line">    prefer-ip-address: true</span><br><span class="line">  client:</span><br><span class="line">    register-with-eureka: false</span><br><span class="line">    fetch-registry: false # eureka服务是否向自己注册,默认true.这里我们不想自己注册</span><br><span class="line">    service-url:          # eureka的注册地址</span><br><span class="line">      defaultZone: http://$&#123;eureka.host:localhost&#125;:$&#123;eureka.port:9000&#125;/eureka/</span><br></pre></td></tr></table></figure></li>
<li>创建App入口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@EnableEurekaServer</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class RegistryApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(RegistryApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="三、配置中心"><a href="#三、配置中心" class="headerlink" title="三、配置中心"></a>三、配置中心</h1><h2 id="相关依赖-1"><a href="#相关依赖-1" class="headerlink" title="相关依赖"></a>相关依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-netflix-eureka-client&apos;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-config-server&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>首先，创建module <code>basic-config</code></li>
<li>配置 <code>build.gradle</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-netflix-eureka-client&apos;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-config-server&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置 <code>application.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9010</span><br></pre></td></tr></table></figure></li>
<li>配置 <code>bootstrap.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: basic-config</span><br><span class="line">  profiles:</span><br><span class="line">    active: native # 表示是用本地配置文件中读取配置</span><br><span class="line">  cloud:           # 配置是从哪里读取配置文件</span><br><span class="line">    config:</span><br><span class="line">      server:</span><br><span class="line">        native:</span><br><span class="line">          search-locations: classpath:/config</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    non-secure-port: $&#123;server.port&#125;</span><br><span class="line">    metadata-map:</span><br><span class="line">      instanceId: $&#123;server.port&#125;</span><br><span class="line">    prefer-ip-address: true</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://$&#123;eureka.host:localhost&#125;:$&#123;eureka.port:9000&#125;/eureka/</span><br></pre></td></tr></table></figure></li>
<li>好，新建<code>recources/config/application-dev.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jpcloud:</span><br><span class="line">  mongodb:</span><br><span class="line">    uri: mongodb://localhost:27017/jpcloud</span><br><span class="line">  test: jjjjjp</span><br></pre></td></tr></table></figure></li>
<li>最后，创建入口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 当然这里，用 @EnableEurekaClient 也是OK的</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@EnableConfigServer</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class ConfigApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(ConfigApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="四、愉快地写业务代码"><a href="#四、愉快地写业务代码" class="headerlink" title="四、愉快地写业务代码"></a>四、愉快地写业务代码</h1><h2 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤"></a>步骤</h2><p>我们很愉快，想要新建一个专门计算每日花费的微服务，并尝试让其注册到我们的注册中心当中，且能够获取配置中心的配置。</p>
<ol>
<li>创建module <code>micro-financial-manager</code></li>
<li>配置<code>build.gradle</code>，让其能够往注册中心注册，并且可以读取配置 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-netflix-eureka-client&apos;</span><br><span class="line">    compile group: &apos;org.springframework.boot&apos;, name: &apos;spring-boot-starter-web&apos;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-config&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置<code>application.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9200</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &apos;*&apos;</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: ALWAYS</span><br></pre></td></tr></table></figure></li>
<li>配置<code>bootstrap.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: micro-financial-manager</span><br><span class="line">  cloud:      # 配置能够扫描配置服务并获取相关配置</span><br><span class="line">    config:</span><br><span class="line">      discovery:</span><br><span class="line">        enabled: true</span><br><span class="line">        service-id: basic-config</span><br><span class="line">      profile: $&#123;JP_CLOUD_CONFIG_PROFILE:dev&#125;</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://$&#123;eureka.host:localhost&#125;:$&#123;eureka.port:9000&#125;/eureka/</span><br></pre></td></tr></table></figure></li>
<li>好，写入口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class FinancialManagerApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(FinancialManagerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>最后，写一个计算花费的API，并尝试去拿到配置中心里头的配置： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;financial/cost&quot;)</span><br><span class="line">public class CostController &#123;</span><br><span class="line">    @Value(&quot;$&#123;jpcloud.test&#125;&quot;)</span><br><span class="line">    private String testName;</span><br><span class="line"></span><br><span class="line">    @GetMapping</span><br><span class="line">    public BigDecimal get() &#123;</span><br><span class="line">        System.out.println(testName);</span><br><span class="line">        return BigDecimal.valueOf(3000 * Math.random());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>OK，此时，依次启动：</p>
<ol>
<li>basic-registry</li>
<li>basic-config</li>
<li>micro-financial-manager</li>
</ol>
<p><img src="../images/spring_cloud/1.png" alt></p>
<p>然后，就能够在eureka中心<code>http://localhost:9000</code>中看到几个服务已经注册了：<br><img src="../images/spring_cloud/2.png" alt></p>
<p>并且，调用<code>http://localhost:9200/finanical/cost</code>，可以正常请求API：<br><img src="../images/spring_cloud/3.png" alt></p>
<h1 id="五、网关与负载均衡"><a href="#五、网关与负载均衡" class="headerlink" title="五、网关与负载均衡"></a>五、网关与负载均衡</h1><h2 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>新建module <code>basic-gateway</code></li>
<li>配置<code>build.gradle</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-netflix-eureka-client&apos;</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-gateway&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置<code>application.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9020</span><br><span class="line"></span><br><span class="line"># actuator 服务状态检测相关API，全开放</span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &quot;*&quot;</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br></pre></td></tr></table></figure></li>
<li>配置 <code>bootstrap.yml</code>，这边可以配置yml方式的routing策略 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: basic-gateway</span><br><span class="line">  cloud:</span><br><span class="line">    gateway:</span><br><span class="line">      routes:</span><br><span class="line">        - id: micro-financial-manager-route</span><br><span class="line">          uri: http://192.168.0.102:9200/</span><br><span class="line">          predicates:</span><br><span class="line">            - Path=/financial/**</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    prefer-ip-address: true</span><br><span class="line">    non-secure-port: $&#123;server.port&#125;</span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http://$&#123;eureka.host:localhost&#125;:$&#123;eureka.port:9000&#125;/eureka/</span><br></pre></td></tr></table></figure></li>
<li>最后，创建入口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class GatewayApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">//    以下是Java方式的Routing配置</span><br><span class="line">//    @Bean</span><br><span class="line">//    public RouteLocator customRouteLocator(RouteLocatorBuilder builder) &#123;</span><br><span class="line">//        return builder.routes()</span><br><span class="line">//                .route(r -&gt; r.path(&quot;/financial&quot;).uri(&quot;https://localhost:9200&quot;))</span><br><span class="line">//                .build();</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>然后，我们启动gateway，端口为9020</li>
<li>就可以通过call <code>http://localhost:9020/financial/cost</code> API 路由到 我们的微服务上了<br><img src="../images/spring_cloud/4.png" alt></li>
</ol>
<h1 id="六、集成Admin"><a href="#六、集成Admin" class="headerlink" title="六、集成Admin"></a>六、集成Admin</h1><p>好，这时，已经有了4个服务在运行了：<br><img src="../images/spring_cloud/5.png" alt><br>然后，我们想给他一个更加好看的monitoring页面，怎么办呢？ </p>
<p>答案：再加多一个基础微服务<code>basic-admin</code>，来实时监控大家的运行状况吧。</p>
<h2 id="相关依赖-2"><a href="#相关依赖-2" class="headerlink" title="相关依赖"></a>相关依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">de.codecentric:spring-boot-admin-starter-server:2.1.6</span><br><span class="line">de.codecentric:spring-boot-admin-starter-client:2.1.6</span><br></pre></td></tr></table></figure>
<h2 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>创建gradle module，名为<code>basic-admin</code></li>
<li>给上配置<code>build.gradle</code>: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    // enable admin服务端</span><br><span class="line">    compile group: &apos;de.codecentric&apos;, name: &apos;spring-boot-admin-starter-server&apos;, version: &apos;2.1.6&apos;</span><br><span class="line">    // 作为 eureka客户端，用于注册自己，并且从eureka服务器上面实时读取大家的状态</span><br><span class="line">    compile group: &apos;org.springframework.cloud&apos;, name: &apos;spring-cloud-starter-netflix-eureka-client&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>配置<code>application.yml</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9030</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: basic-admin</span><br><span class="line">eureka:</span><br><span class="line">  client:</span><br><span class="line">    registry-fetch-interval-seconds: 5</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: $&#123;EUREKA_SERVICE_URL:http://localhost:9000&#125;/eureka/</span><br><span class="line">  instance:</span><br><span class="line">    leaseRenewalIntervalInSeconds: 10</span><br><span class="line">    health-check-url-path: /actuator/health</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &quot;*&quot;</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br></pre></td></tr></table></figure></li>
<li>入口 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@EnableAdminServer</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class AdminApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(AdminApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>此时，启动admin服务；</li>
<li>打开<code>http://localhost:9300</code>，可以看到<code>admin</code>服务 和 <code>config</code>服务都是UP的状态；</li>
<li>此时，如果发现<code>gateway</code>和<code>micro-financial-manager</code>服务是DOWN状态，那么，需要给他们俩加上这个库： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile group: &apos;de.codecentric&apos;, name: &apos;spring-boot-admin-starter-client&apos;, version: &apos;2.1.6&apos;</span><br></pre></td></tr></table></figure></li>
<li>并且，给他们俩打开acturator 健康检查相关接口： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &quot;*&quot;</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br></pre></td></tr></table></figure></li>
<li>然后，重启gateway 和 micro-financial-manager服务，即可。</li>
</ol>
<p><img src="../images/spring_cloud/6.png" alt></p>
<h2 id="给admin监控台加上登录页"><a href="#给admin监控台加上登录页" class="headerlink" title="给admin监控台加上登录页"></a>给admin监控台加上登录页</h2><p>因为安全登录相关的功能与页面被集成到了<code>security</code>库里头，所以，我们需要在admin服务中，做一些enhancement了：</p>
<ol>
<li>为<code>basic-admin/build.gradle</code>添加依赖库： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compile group: &apos;org.springframework.boot&apos;, name: &apos;spring-boot-starter-web&apos;</span><br><span class="line">compile group: &apos;org.springframework.boot&apos;, name: &apos;spring-boot-starter-security&apos;</span><br></pre></td></tr></table></figure></li>
<li>修改<code>basic-admin/.../application.yml</code>，添加登录用户相关配置： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  #    登录页相关：配置spring security的用户名和密码</span><br><span class="line">  security:</span><br><span class="line">    user:</span><br><span class="line">      name: &quot;admin&quot;</span><br><span class="line">      password: &quot;admin&quot;</span><br><span class="line"></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    #    登录页相关：这时需要在服务注册时带上metadata-map的信息</span><br><span class="line">    metadata-map:</span><br><span class="line">      user.name: $&#123;spring.security.user.name&#125;</span><br><span class="line">      user.password: $&#123;spring.security.user.password&#125;</span><br></pre></td></tr></table></figure></li>
<li>最后，添加一个<code>WebSecurityConfigurerAdapter</code>实现类，作为<code>basic-admin</code>服务的一个Configuration： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class SecuritySecureConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">    private final String adminContextPath;</span><br><span class="line"></span><br><span class="line">    public SecuritySecureConfig(AdminServerProperties adminServerProperties) &#123;</span><br><span class="line">        this.adminContextPath = adminServerProperties.getContextPath();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        // @formatter:off</span><br><span class="line">        SavedRequestAwareAuthenticationSuccessHandler successHandler = new SavedRequestAwareAuthenticationSuccessHandler();</span><br><span class="line">        successHandler.setTargetUrlParameter(&quot;redirectTo&quot;);</span><br><span class="line"></span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(adminContextPath + &quot;/assets/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(adminContextPath + &quot;/login&quot;).permitAll()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin().loginPage(adminContextPath + &quot;/login&quot;).successHandler(successHandler).and()</span><br><span class="line">                .logout().logoutUrl(adminContextPath + &quot;/logout&quot;).and()</span><br><span class="line">                .httpBasic().and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">        // @formatter:on</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>重启<code>basic-admin</code>服务，会发现，再次访问<code>localhost:9030</code>时，就会重定向到登录界面，登录的用户名和密码为配置文件中配置的，分别为admin和admin。</li>
</ol>
<p><img src="../images/spring_cloud/7.png" alt><br>大功告成！！</p>
<h1 id="七、集成Lombok"><a href="#七、集成Lombok" class="headerlink" title="七、集成Lombok"></a>七、集成Lombok</h1><p>如果我们直接去mvnrepository.com, 直接拿gradle 的Lombok的依赖方式放到我们的项目中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">subprojects &#123;</span><br><span class="line">    // ...................</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        // .......................</span><br><span class="line">        providedCompile group: &apos;org.projectlombok&apos;, name: &apos;lombok&apos;, version: &apos;1.18.2&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    // ...................</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>会报这样的错误：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">A problem occurred evaluating root project &apos;jp-cloud-gradle&apos;.</span><br><span class="line">&gt; Could not find method providedCompile() for arguments [&#123;group=org.projectlombok, name=lombok, version=1.18.2&#125;] on object of type org.gradle.api.internal.artifacts.dsl.dependencies.DefaultDependencyHandler.</span><br></pre></td></tr></table></figure>
<p>然后，编译失败。</p>
<p>这应该是由于enable Lombok的写法，对于我们这个Gradle版本搭建的project 来说有误。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="1-官方推荐方式"><a href="#1-官方推荐方式" class="headerlink" title="1. 官方推荐方式"></a>1. 官方推荐方式</h3><p><a href="https://docs.gradle.org/4.7-rc-1/userguide/java_plugin.html#sec:java_compile_avoidance" target="_blank" rel="noopener">官方文档</a> | <a href="https://stackoverflow.com/questions/50519138/annotationprocessor-gradle-4-7-configuration-doesnt-run-lombok" target="_blank" rel="noopener">stackoverflow: correct way</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">annotationProcessor &apos;org.projectlombok:lombok:1.18.2&apos;</span><br><span class="line">compileOnly &apos;org.projectlombok:lombok:1.18.2&apos;</span><br><span class="line">testAnnotationProcessor &apos;org.projectlombok:lombok:1.18.2&apos;</span><br><span class="line">testCompileOnly &apos;org.projectlombok:lombok:1.18.2&apos;</span><br></pre></td></tr></table></figure>
<h3 id="2-使用Gradle-Plugin的方式"><a href="#2-使用Gradle-Plugin的方式" class="headerlink" title="2. 使用Gradle Plugin的方式"></a>2. 使用Gradle Plugin的方式</h3><p><a href="https://projectlombok.org/setup/gradle" target="_blank" rel="noopener">Lombok官网推荐配法</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">	mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">	compileOnly &apos;org.projectlombok:lombok:1.18.10&apos;</span><br><span class="line">	annotationProcessor &apos;org.projectlombok:lombok:1.18.10&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>好，当你做完以上的这些步骤，基本的一个简单的Spring Cloud微服务项目的雏形就诞生了！</p>
<p>之后的文章，我们会在此项目基础上更进一步地专研各个服务的特性，并深入学习~</p>

    </div>

    
    
    
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
  <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.png" alt="Jasper Wu wechat" style="width: 200px; max-width: 100%;">
  <div>喜欢的朋友可以关注 "JP技术栈" 微信公众号，每周更新笔者最新分享技术文章~</div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/gradle/" rel="tag"># gradle</a>
              <a href="/tags/spring-cloud/" rel="tag"># spring cloud</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/Spring%20AOP%E5%8E%9F%E7%90%86%E4%B8%8E%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94/" rel="next" title="Spring AOP原理与技术对比">
                  <i class="fa fa-chevron-left"></i> Spring AOP原理与技术对比
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/%E7%94%A8Gradle%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%20Spring%20Cloud%20Greenwich.SR4%20%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%88%E4%BA%8C%EF%BC%89--%20%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" rel="prev" title="用Gradle从零搭建 Spring Cloud Greenwich.SR4  微服务项目（二）-- 配置中心">
                  用Gradle从零搭建 Spring Cloud Greenwich.SR4  微服务项目（二）-- 配置中心 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#总体框架"><span class="nav-number">1.</span> <span class="nav-text">总体框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#相关规范"><span class="nav-number">2.</span> <span class="nav-text">相关规范</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一、搭建一个父Gradle目录-root-project"><span class="nav-number">3.</span> <span class="nav-text">一、搭建一个父Gradle目录(root project)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#纯命令create"><span class="nav-number">3.1.</span> <span class="nav-text">纯命令create</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二、服务注册与发现"><span class="nav-number">4.</span> <span class="nav-text">二、服务注册与发现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#相关依赖"><span class="nav-number">4.1.</span> <span class="nav-text">相关依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤"><span class="nav-number">4.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、配置中心"><span class="nav-number">5.</span> <span class="nav-text">三、配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#相关依赖-1"><span class="nav-number">5.1.</span> <span class="nav-text">相关依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-1"><span class="nav-number">5.2.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四、愉快地写业务代码"><span class="nav-number">6.</span> <span class="nav-text">四、愉快地写业务代码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-2"><span class="nav-number">6.1.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五、网关与负载均衡"><span class="nav-number">7.</span> <span class="nav-text">五、网关与负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-3"><span class="nav-number">7.1.</span> <span class="nav-text">步骤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六、集成Admin"><span class="nav-number">8.</span> <span class="nav-text">六、集成Admin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#相关依赖-2"><span class="nav-number">8.1.</span> <span class="nav-text">相关依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#步骤-4"><span class="nav-number">8.2.</span> <span class="nav-text">步骤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#给admin监控台加上登录页"><span class="nav-number">8.3.</span> <span class="nav-text">给admin监控台加上登录页</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#七、集成Lombok"><span class="nav-number">9.</span> <span class="nav-text">七、集成Lombok</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#解决方案"><span class="nav-number">9.1.</span> <span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-官方推荐方式"><span class="nav-number">9.1.1.</span> <span class="nav-text">1. 官方推荐方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-使用Gradle-Plugin的方式"><span class="nav-number">9.1.2.</span> <span class="nav-text">2. 使用Gradle Plugin的方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总结"><span class="nav-number">10.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Jasper Wu"
    src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Jasper Wu</p>
  <div class="site-description" itemprop="description">醒目点、自觉点、速度点，努力奋斗下去，走好自己的路！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/androidjp" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;androidjp" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1049578026@qq.com" title="E-Mail &amp;rarr; mailto:1049578026@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jasper Wu</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  






  <script src="/js/local-search.js"></script>










<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'default',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>



  

  

  

  

</body>
</html>
